\section{Methods}\label{sec:methods}
\subsection{KAPRI: FMCW radar data processing}\label{sec:proc_SLC}
A fundamental requirement to generate calibrated polarimetric data is the availability of properly focused SLC images for all the desired polarizations. To obtain this data, it is necessary to understand the data acquisition process and correct several effects caused by the specific hardware design.  
For this purpose a signal model for type II\cite{Caduff2015} radar data using FMCW signaling\cite{Stove1992} is introduced.\\
\begin{figure}[h]
	\centering
	\includegraphics[scale=1]{real_aperture_signal_model_geometry}
	\caption{Geometry used to derive the FMCW signal model. $R$ is the slant range from the radar to the point scatterer, $\theta_{3dB}$ is the antenna half power beamwidth, which is represented by the gray triangle. The size of the antenna aperture is $L_{ant}$, the corresponding azimuth resolution (in distance units) is $\delta_{az}$. The inset figure is used to derive the azimuth phase variation. $L_{ph}$ is the phase center displacement, $L_{arm}$ is the antenna rotation lever arm, $R_{0}$ the range of closest approach and $\alpha$ the additional angle to obtain closest approach when the phase center is not in the midpoint of the array.}
	\label{fig:real_aperture_signal_model_geometry}
\end{figure}
Consider a coordinate system with origin at the location of a radar as depicted in \autoref{fig:real_aperture_signal_model_geometry}. In this system, the antenna is mounted on a lever arm of length $L_{arm}$; its mainlobe is parallel to the $x$ axis when the pointing angle $\theta$ is 0. The radar images a scene with a complex reflectivity distribution $\rho\left(x,y\right)$ by measuring range profiles $\hat{\rho}\left(R, \theta\right)$ for a number of antenna rotation angles (azimuths) $\theta = \operatorname{arctan}\left(\frac{y}{x}\right)$ by rotating the antenna with the angular speed $\omega$. Each profile is measured by transmitting a linearly modulated signal of duration $t_{chirp}$ with bandwidth $B$ and center frequency $f_c$:\\
\begin{equation}
	s_t\left(t\right) = e^{j 2 \pi \left( t f_{c} +  \frac{B}{t_{chirp}} t^2 \right)}.
\end{equation}
In the case of KAPRI, $f_c= 17.2~GHz$ and $B=200~MHz$.\\
The total time that the signal takes to travel to a scatterer at range $R$ and back is $t_{c} = \frac{2 R}{c}$. The backscattered signal $s_r$ is a copy of the one being transmitted; delayed by $t_{c}$ and scaled by the complex reflectivity of the scatterer $\rho$.
\begin{equation}
		s_r\left(t\right) = \rho e^{j 2 \pi \left( \left(t - \frac{2 R}{c}\right) f_{c} +  \frac{B}{t_{chirp}} \left(t - \frac{2 R}{c}\right)^2 \right)}.
\end{equation}
The received backscattered signal is $s_r$  mixed with the transmitted chirp $s_t$  to remove the linear modulation; the resulting beat signal is then sampled and stored in the device. It frequency $f_{b} = \frac{4 R B}{c t_{chirp}}$ is proportional to the slant range $R$:
\begin{equation}\label{eq:deramp}
	\begin{aligned}
	s_{d}\left(t\right) &=s_t\left(t\right)s_r\left(t\right)^* =\\ 
	&\sigma e^{j 4 \pi \frac{ R}{c}f_c}  e^{j 4 \pi \frac{2 R B }{c t_{chirp}} t}  e^{j 4 \pi \frac{2 R^2 B}{c^2}}.
	\end{aligned}
\end{equation} 
In this expression, two phase terms can be identified: $ e^{j 4 \pi \frac{R}{c}f_c}$ is the two way propagation phase, the quantity of interest for  interferometric measurements. The second phase component is the residual video phase (RVP). This component needs to be compensated for SAR processing, where its variation during the aperture time may cause defocussing.\\
From  linearity it follows from \autoref{eq:deramp} that the range profile $\hat{\sigma}\left(R, \theta\right)$ of a collection of targets with complex reflectivities $\rho_i$ located at ranges $R_{i}$ is recovered by taking the Fourier transform of $s_{d}\left(t\right)$.\\
As for pulsed radars, the range resolution  for a FMCW system is inversely proportional to the bandwidth $\delta_{r} = \frac{c}{2 B}$. Using $B=200 MHz$ KAPRI achieves a range resolution of 0.75 m\cite{Strozzi2011}; however the effective range resolution is lower because the dechirped data is windowed before the Fourier transform to mitigate range sidelobes. It is interesting to note that for FMCW system the sampling rate is not governed by the transmitted bandwidth; instead it is dictated by the extent of ranges to be imaged\cite{Meta2006}.\\
To obtain two dimensional images range profiles are acquired while the antenna is rotated with angular velocity $\omega$.
Thus, the dechip signal for a point target at $R, \theta_{t}$ in the slow-time versus fast time plane is:
\begin{equation}\label{eq:signal_model}
	\begin{aligned}
	& s_{d}\left(t,\tau\right) = \sigma e^{j 4 \pi \frac{ R}{c}f_c}   \\
	& e^{j 4 \pi \frac{2 R B }{c t_{chirp}} t}  e^{j 4 \pi \frac{2 R^2 B}{c^2}} P\left(\tau \omega - \theta\right),
	\end{aligned}
\end{equation} 
where $t$ is the fast time, $\tau = n t_{chirp}$ is the slow time variable and $P\left(\tau \omega\right)$ describes the two way antenna pattern. Its beamwidth is approximated by:
\begin{equation}\label{eq:azimuth_resolution}
	\theta_{3dB} = \frac{\lambda}{L_{ant}}
\end{equation}
where $L_{ant}$ is the size of the antenna aperture and $\lambda$ is the wavelength employed.
Due to diffraction, the radiation beam emitted by the antenna broadens linearly with increasing distance consequently, the spatial resolution in cross-range $\delta_{az}$ increases with distance:
\begin{equation}\label{eq:azimuth_ground_resolution}
	\delta_{az} = \frac{R \lambda}{L_{ant}}.
\end{equation}
%The typical applications of KAPRI require a ground resolution on the order of a few meters at ranges up to 8 km, requiring a beamwidth. To obtain a beamwidth of $0.4^\circ$ at $17.1 GHz$, $L_{ant} = 2m$. 
KAPRI employs a traveling wave slotted waveguide antenna\cite{Hines1953a,Granet2007}; it constructed by cutting slots resonating at the design frequency in a section of rectangular waveguide. When they are appropriately spaced, the fields emitted at each cut combine in phase, producing a narrow beam. Two types of slotted waveguide antenna exist\cite{Enjiu2013}: the resonant and the traveling wave design. The second type has been chosen because it supports a larger bandwidth; this permits to achieve a finer range resolution. However this antenna design displays frequency-dependent beam squint: if it is operated at a frequency other than the design value, the phase difference at the slots changes with the effect of squinting the beam away from the intended mainlobe direction. This effect has been used for several fast imaging radar, where a mechanical antenna rotation would not be possible\cite{Yang2014,Yang2012,Mayer2003,Alvarez2013}. In the case of KAPRI the squint is undesired: since the amount of squint is large compared to the beamwidth, the beam only illuminates a scatterer for a fraction of $t_{chirp}$, decreasing the effective transmitted bandwidth and hence the range resolution.  If the antenna is rotated slowly enough,  the spacing of each range profile is less than the beamwidth and the effect of beam squint is visible in the slow-fast time domain as skewing of point target responses, as illustrated in\autoref{fig:squint_correction}: the target is only inside the beamwidth during the chirp at the time when the antenna rotation angle matches the beam squint angle. 
The azimuth-frequency skewing observed in oversampled data is key to mitigate the effect of the beam squint. For each chirp frequency $f$, the data at the corresponding fast time $s_{d}\left(t,\tau\right)$ is shifted back in azimuth by $\tau_{sq}=\frac{\theta_{sq}}{\omega}$, where the squint angle is:
\begin{equation}\label{eq:squint_exact}
	\theta_{sq} = \sin^{-1}\left(\frac{\lambda}{\lambda_{g_{ij}}} + \frac{k \lambda}{s}\right).
\end{equation}
here ${\lambda_g}_{ij}$ is the wavelength for the $ij$-TE mode of the waveguide, $\lambda$ is the freespace wavelength, $s$ is the element spacing and $k$ is the mode number. In this case, the waveguide mode used is TE01 and $k=0$ is assumed because all the slots are to be transmitting in phase\cite{kraus88} to direct the main beam at the antenna broadside.\\
In processing KAPRI data a linear approximation for the squint relative to the pointing at the design frequency $f_c$ is used instead:
\begin{equation}\label{eq:squint_linearised}
	\theta_{sq} - \theta_{sq}^{f_{c}}  =  \alpha f.
\end{equation}
this choice is necessary because manufacturer-provided antenna pattern measurements at different frequencies suggest that the vertically and the horizontally polarized units have different squint characteristics.\\ No other design information being available, a data-driven method had to be used for the correction of the beam squint. To estimate the linear squint rate $\alpha$, the response of a strong point-like target is extracted from the data by windowing it in range compressed data and converting it back in the fast time domain; its envelope is then extracted with a discrete Hilbert transform. Finally a fit using the model of \autoref{eq:squint_linearised} is performed to obtain an estimate of $\alpha$.\\
To correct the frequency-dependent beam squint the azimuth sample spacing smaller must be smaller than the antenna beamwidth: this permits to reconstruct the full bandwidth illumination of each scatterer with by combining chirp samples acquired at subsequent azimuth positions. A side benefit of oversampling is that several range profiles that in first approximation can be seen as representing independent realizations of the same scatterers can be averaged to improve the measurement SNR, producing range-azimuth images with an angular resolution limited by the antenna beamwidth.\\
\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.2]{squint_correction}
	\caption{Illustration of the frequency-dependent antenna squint. When the antenna rotates during the electronic scan, the energy of the target is spread through several azimuth bins.}
	\label{fig:squint_correction}
\end{figure}
After correcting the beam squint, the first and last $z$ samples of the raw data $s_{d}$ are windowed with an Hann window to mitigate the transient signal caused by the abrupt change in frequency due to the repetition of the chrip. A second Kaiser Window is then applied to reduce range processing sidelobes that are caused by the finite bandwidth. Finally, a fast time Fourier transform implements the range compression to obtain the SLC image $\hat{\rho}\left(R, \theta\right)$.\\ Each range line of the SLC thus compressed is then multiplied by $\sqrt{R^3}$ to compensate for the power spreading loss. In this manner, the intensity of the SLC data is directly proportional to the radar brightness $\beta_{0}$.
\subsection{Antenna Pattern Misalingment}\label{sec:misalingment}
In addition to the difference in frequency-dependent squint rate, the horizontally and the vertically polarized antennas appear have an azimuth mispointing of approx. $0.2^\circ$. It was first observed by analyzing the response of strong point-like target, where a significant misregistration between the $HH$ and the $VV$ images was observed. The misalignment is particularly problematic for cross-polar measurements: the transmitting and receiving patterns are not aligned. Using the available pattern information a power loss of approx 2.5 dB  compared to the ideal case is predicted. This loss reduces the SNR for the cross-polar channels, leading to noisier measurements.\\ While the offset between copolar channels can be corrected by coregistration without major consequences, there is no method capable to compensate the SNR loss in the crosspolar measurements a posteriori. An adjustable antenna mount was manufactured by replacing one of two hinges where the antennas are fixed on the towers (see \autoref{fig:adjustable_bracket}) with an adjustable bracket that allows to slide the antenna back and forth on the one side, obtaining the effect of rotating it around the center. Basing on the size of the antenna mounting bracket and on the amount of misaligment, it was determined that the horizontally polarized antennas need to be shifted by 1.8 mm to compensate form the pattern mispointing.
\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.3]{antenna_offset_2}
	\caption{Illustration of the adjustable antenna mount allowing to shift the patterns to bring the H and the V antennas into alignment.}
	\label{fig:adjustable_bracket}
\end{figure}
\subsection{Polarimetric Calibration}\label{sec:proc_polcal}
In the case of GPRI the processing is concluded after range compression and the data is ready for interferometric applications. In the case of  KAPRI, additional steps are necessary to obtain polarimetric measurements that are well calibrated.\\ The first of these steps requires a brief review of the polarimetric antenna configuration, as it is depicted in \autoref{fig:antenna_arrangement}:\\ Six antennas are mounted on a supporting structure connected to the rotary scanner. Of these, 2 are transmitting antennas, one for each polarization. The remaining 4 are connected through switches to the receivers in pairs; each pair composed of an horizontally and a vertically polarized unit. This configuration permits to acquire full polarimetric dataset by selecting the desired antennas for the transmitter and for each receiver separately. Because only one combination is acquired at a time and the antennas are not collocated, this arrangement ensures a low level of polarimetric crosstalk. Additionally, the separation of transmitting and receiving antennas increases the TX-RX isolation, a fundamental requirement for FMCW performance\cite{Beasley1990,Stove1992, Strozzi2011}.  However, this configuration complicates the phase calibration of polarimetric data.
\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.15]{kapri_antenna_arrangement}
	\caption{KAPRI with the usual antenna arrangement overlaid. }
	\label{fig:antenna_arrangement}
\end{figure}
Consider an image $i$ acquired by transmitting at antenna located at $\mathbf{x_t^i}$ and receiving at $\mathbf{x_r^i}$. These antennas can be replaced by an equivalent antenna located at $\mathbf{x_{eq}^i}$, the midpoint between transmitter and receiver \cite{Pipia2009}. Thus, for polarimetric observations using  KAPRI the equivalent antenna phase center $\mathbf{x_{eq}^i}$ location will change depending on the chosen polarization. Therefore, there exist certain combinations of channels $i$ and $j$ where the equivalent phase centers will be separated by a baseline $\mathbf{b_{ij}^{eq}}$. Consequently, the polarimetric phase difference $\phi_{ij} = \phi_{ij}^{pol} + \phi_{ij}^{prop}$  will contain an interferometric contribution $\phi_{ij}^{prop}$. This term appears as topographic fringes when visualizing the polarimetric phase difference and will complicate calibration by adding an additional phase contribution unrelated to the polarimetric properties of the scatterers.\\
To obtain valid polarimetric phase differences, it is necessary to estimate and subtract the interferometric contribution. This can be done  by considering two additional channel $k$ and $l$  acquired with  a non-zero baseline $\mathbf{b_{ij}^{eq}}$ and with the same polarization, where $\phi_{kl}^{pol} \approx 0$. Generally, for any two channels $m$ and $n$,  the propagation phase difference can be approximated as a function of the local incidence angle and of the perpendicular baseline separating the phase centers:
\begin{equation}\label{eq:prop_approximation}
		\phi_{mn}^{prop} = \frac{4\pi}{\lambda} b_{mn}^{eq} \sin(\theta - \alpha_{bl}),
\end{equation}
where $\alpha_{bl}$ is the baseline angle w.r.t to the vertical and the look angle $\theta_l$ is the angle between the line of sight vector $\mathbf{p}$ and the vertical axis and $b_{ij}^{eq}$ is the perpendicular baseline between the equivalent phase centers.
Thus from \autoref{eq:prop_approximation}, $\phi_{ij}^{prop}$ can be estimated from $\phi_{kl}$ if the look angle does not significantly change from $kl$ to $ij$, i.e if $\theta_{ij} - \alpha_{ij} \approx \theta_{kl} - \alpha_{kl}$. 
\begin{equation}
	\hat{\phi}_{ij}^{prop} = \frac{b_{eq}^{ij}}{b_{eq}^{kl}} \phi_{kl}.
\end{equation}
This formula can only be used if $\frac{b_{eq}^{ij}}{b_{eq}^{kl}}$ is integer\cite{Massonnet1996}, if this condition is not met, phase unwrapping of $\phi_{kl}^{prop}$ is necessary before rescaling.\\
In order to correct for all the possible combinations that have a non-zero baseline, the measured scattering matrix $\mathbf{S}$ is converted into a polarimetric covariance matrix;  $\hat{\phi}_{ij}^{prop}$ it then subtracted from the phase of every non-diagonal element $ij$. The result is a flattened covariance matrix where the sole phase contribution is the polarimetric phase difference.\\
This matrix is the starting point for the polarimetric calibration proper;
the procedure is based on the linear distortion matrix model\cite{Saraband1990, Sarabandi1992a} that relates the observed scattering matrix $\mathbf{S_{meas}}$ with the correct matrix $\mathbf{S}$:
\begin{equation}\label{eq:distorsion_scattering}
	\mathbf{S_{meas}} = \mathbf{R} \mathbf{S} \mathbf{T}.
\end{equation}
or in covariance form
\begin{equation}\label{eq:covariance_distortion}
	\mathbf{C}_{meas} = \mathbf{D} \mathbf{C} \mathbf{D}^{H}.
\end{equation}
where $\mathbf{D}$ is the Kronecker product of $\mathbf{R}$ and $\mathbf{T}$, the matrices that describe the phase and amplitude imbalances and crosstalk in reception and transmission.
In the case of KAPRI, crosstalk calibration is not performed as the radar is expected to have a good polarization isolation, largely due to the fact that only one polarization is acquired at a time by selecting the appropriate combination of transmitting and receiving antennas. The only source of crosstalk is the presence of cross-polarized lobes in the direction of the antenna mainlobe. The manufacturer has provided simulated radiation patterns for the horizontally polarized antennas, where the isolation between the co and the cross polarized pattern in the main-lobe direction is observed to be better than 60 dB. By computing the $VV-HV$ ratio of the oversampled response of a trihedral corner reflector, the polarization purity of the system was estimated to be better than 35 dB.\\
Thus, neglecting crosstalk the matrices can be written as:
\begin{equation}
	\begin{aligned}
	&\mathbf{R} = A \begin{bmatrix}
		1 & 0\\
		0 & f/g e^{i\phi_{r}}
	\end{bmatrix},\\
	&\mathbf{T} = A \begin{bmatrix}
			1 & 0\\
			0 & f g e^{i\phi_{t}}
		\end{bmatrix}
	\end{aligned}
\end{equation}
where $f$ is the one-way copolar amplitude imbalance with respect to the $H$ polarization, and $g$ the amplitude imbalance of the crosspolarized channels. $\phi_t = \phi_{t,h} -\phi_{t,v}$ is the phase offset between the polarizations when transmitting and $\phi_{r} = \phi_{r,h} -\phi_{r,v}$ is the phase offset in reception and $A$ is the absolute amplitude calibration parameter (RCS)\cite{Ainsworth2006a, Fore2015}.\\
The four unknown complex parameters in $\mathbf{D}$ can be determined using a trihedral corner reflector and a reciprocal scatterer with a significant cross polarized contribution\cite{Sarabandi1989,Pipia2009}.\\
With the above model, an ideal trihedral reflector with the scattering matrix
\begin{equation}
 \mathbf{S} = \sqrt{\sigma_{tri}}
 \begin{bmatrix}1 & 0\\ 0 & 1\end{bmatrix}
\end{equation}
where $\sigma_{tri}$ is its RCS, has a measured covariance matrix $\mathbf{C^{\prime}}$:
\begin{equation}
	\begin{aligned}
	&\mathbf{C^{\prime}} =\\
	&= k \sigma_{tri}\\
	&\begin{bmatrix}
		1 & 0 & 0 & f^2 e^{-i \left(\phi_t + \phi_r\right)}\\
		0 & 0 & 0 & 0\\
		0 & 0 & 0 & 0\\
		f^2 e^{i \left(\phi_t + \phi_r\right)} & 0 & 0 & f^4
	\end{bmatrix}
	\end{aligned}.
\end{equation}
The copolar amplitude imbalance $f$ is estimated of the HHHH and VVVV elements of $\mathbf{C^{\prime}}$:
\begin{equation}
	f = \left(\frac{C^{\prime}_{VVVV}}{C^{\prime}_{HHHH}}\right)^{\frac{1}{4}}.
\end{equation}
Similarly, the copolar imbalance phase $\phi_r + \phi_t$ is determined from the phase of $C_{VVHH}^{prime}$:
\begin{equation}
	\phi_r + \phi_t = \operatorname{arg}\left(C_{meas}^{VVHH}\right).
\end{equation}
Both parameters are estimated on the oversampled response of a corner reflector.
Because of the difficulty of placing and correctly orienting a dihedral reflector, the estimation of $g$ and $\phi_t - \phi_r$ is based on the assumption that most pixels in the calibration dataset represent reciprocal scatterers:
\begin{equation}
	g = \left<\frac{C_{rec}^{HVHV}}{C_{rec}^{VHVH}}\right>^\frac{1}{4},
\end{equation}
and:
\begin{equation}
	\phi_t - \phi_r =\operatorname{arg}\left( \left<C_{meas}^{HVVH}\right>\right).
\end{equation}
When $\mathbf{D}$ is estimated, \autoref{eq:covariance_distortion} is inverted to obtain a calibrated covariance matrix.\\
If radiometric calibration is desired, the value of $A$ can be determined after imbalance correction:
\begin{equation}
	A =	\left(\frac{\sigma_{tri}}{C^{\prime}_{HHHH} R^{3}}\right).
\end{equation}
where $R$ is the slant range to the trihedral corner reflector.
\subsection{Experimental Data}\label{sec:data}
A calibration dataset was acquired in September 2016 at an urban-agricultural area near M\"{u}nsingen, Switzerland to test the methods described above. The data was acquired from the top of an hill approximately 800 m high, looking down towards fields and the town. 6 Trihedral Corner Reflectors were placed in the scene for the determination of calibration parameters and to assess imaging quality. Three of these reflectors have triangular faces with a length of 40 cm, corresponding to a RCS of $\sigma=\frac{4}{3}\pi \frac{a^4}{\lambda^2}=25.5 dB$, while the remaining two are cubic corner reflector with $\sigma= 35 dB$, at the nominal central frequency of 17.2 GHz.
	\begin{figure}
		\centering
		\includegraphics{figure_7}
		\caption{Pauli RGB composite of the imaged scene. The location of calibration corner reflector is marked by blue circles.}
		\label{fig:pauli_rgb}
	\end{figure}
The dataset was acquired with the horizontally polarized antenna group shifted towards the V group by 1.8 mm to compensate for the pattern misalignment as described in \autoref{sec:misalingment}.\\
\autoref{fig:pauli_rgb} shows the calibrated Pauli RGB composite of the scene, resampled in Cartesian coordinates with the location of the reflectors marked using blue circles; their location and RCS is summarized in \autoref{tab:reflectors}.\\
A separate dataset containing a dihedral reflector was acquired at our H\"{o}nggerberg campus in order to investigate the effect of antenna pattern misalignment on crosspolar acquisitions and to test the suitability of the computed adjustment value as discussed in \autoref{sec:misalingment}. This was done separately because of the logistical complications associated with the transportation and the setup of large calibration targets.


\begin{table}[ht]
	\centering
	\pgfplotstabletypesetfile[
								every head row/.style={before row=\toprule,after row=\midrule},
								every last row/.style={after row=\bottomrule},
								col sep=comma,
								columns={rsl, RCS, type},
								columns/type/.style={column name={Type} ,string type},
								columns/RCS/.style={precision=3, column name=$\sigma_0$},
								columns/rsl/.style={precision=3, column name=$R_0$}
										] {../tab/table_1.csv}
	\caption{Summary of the employed TCRs. Distance from the radar and expected RCS.}
	\label{tab:reflectors}
\end{table}



%\begin{figure}[ht]
%	\centering
%	\begin{subfigure}[b]{\columnwidth}
%		\centering
%		\includegraphics[scale=1]{HIL_20140910_144113_l_03_normal_gc_phase.pdf}
%		\subcaption{Uncorrected}
%		\label{fig:HHVV_phase:unflattened}
%	\end{subfigure}
%	\begin{subfigure}[b]{\columnwidth}
%		\centering
%		\includegraphics[scale=1]{HIL_20140910_144113_l_03_flat_gc_phase.pdf}
%		\subcaption{Corrected}
%		\label{fig:HHVV_phase:flattened}
%	\end{subfigure}
%	\caption{HH VV phase difference. \autoref{fig:HHVV_phase:unflattened}: Phase difference after the correction of the azimuth ramp. The topographic phase ramp is very clearly visible. In  \autoref{fig:HHVV_phase:flattened} the phase after the topographic phase removal is shown. There is no noticeable phase trend.}
%	\label{fig:HHVV_phase}
%\end{figure}
%\FloatBarrier

